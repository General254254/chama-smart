{% extends 'core/base.html' %}
{% block title %}Dashboard - Smart Chama{% endblock %}
{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Dashboard</h1>
        <p>Welcome back, {{ user.username }}!</p>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>My Chamas</h3>
            <p class="stat-number">{{ user_chamas.count }}</p>
            <a href="{% url 'chama_list' %}" class="stat-link">View All</a>
        </div>
        <div class="stat-card">
            <h3>Total Contributions</h3>
            <p class="stat-number">KSh {{ total_contributions|floatformat:2 }}</p>
        </div>
        <div class="stat-card">
            <h3>Unread Messages</h3>
            <p class="stat-number">{{ unread_messages }}</p>
            <a href="{% url 'message_list' %}" class="stat-link">View Messages</a>
        </div>
        {% if profile.is_admin %}
        <div class="stat-card">
            <h3>All Chamas</h3>
            <p class="stat-number">{{ all_chamas.count }}</p>
        </div>
        <div class="stat-card">
            <h3>Total Members</h3>
            <p class="stat-number">{{ all_members }}</p>
        </div>
        <div class="stat-card">
            <h3>Platform Total</h3>
            <p class="stat-number">KSh {{ total_chama_contributions|floatformat:2 }}</p>
        </div>
        {% endif %}
    </div>
    
    <div class="dashboard-grid">
        <div class="dashboard-section">
            <h2>My Chamas</h2>
            {% if user_chamas %}
                <div class="chama-list">
                    {% for chama in user_chamas|slice:":5" %}
                    <div class="chama-card">
                        <h3><a href="{% url 'chama_detail' chama.id %}">{{ chama.name }}</a></h3>
                        <p>{{ chama.description|truncatewords:15 }}</p>
                        <div class="chama-meta">
                            <span>Members: {{ chama.get_member_count }}</span>
                            <span>Contributions: KSh {{ chama.get_total_contributions|floatformat:2 }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if user_chamas.count > 5 %}
                <a href="{% url 'chama_list' %}" class="btn btn-secondary">View All Chamas</a>
                {% endif %}
            {% else %}
                <p>You haven't joined any Chamas yet.</p>
                <a href="{% url 'chama_list' %}" class="btn btn-primary">Browse Chamas</a>
            {% endif %}
        </div>
        
        <div class="dashboard-section">
            <h2>Recent Contributions</h2>
            {% if recent_contributions %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Chama</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contribution in recent_contributions %}
                        <tr>
                            <td>{{ contribution.date }}</td>
                            <td>{{ contribution.membership.chama.name }}</td>
                            <td>KSh {{ contribution.amount|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No contributions yet.</p>
            {% endif %}
        </div>
        
        <div class="dashboard-section">
            <h2>Recent Announcements</h2>
            {% if recent_announcements %}
                <div class="announcement-list">
                    {% for announcement in recent_announcements %}
                    <div class="announcement-item">
                        <h4><a href="{% url 'chama_detail' announcement.chama.id %}">{{ announcement.title }}</a></h4>
                        <p>{{ announcement.content|truncatewords:20 }}</p>
                        <small>{{ announcement.chama.name }} - {{ announcement.created_at|date:"M d, Y" }}</small>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No announcements yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


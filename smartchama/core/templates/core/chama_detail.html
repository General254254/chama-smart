{% extends 'core/base.html' %}
{% block title %}{{ chama.name }} - Smart Chama{% endblock %}
{% block content %}
<div class="container">
    <div class="page-header">
        <h2>{{ chama.name }}</h2>
        {% if can_edit %}
        <a href="{% url 'chama_edit' chama.id %}" class="btn btn-secondary">Edit Chama</a>
        {% endif %}
    </div>
    
    <div class="chama-info">
        <p><strong>Description:</strong> {{ chama.description }}</p>
        <p><strong>Contribution Amount:</strong> KSh {{ chama.contribution_amount|floatformat:2 }}</p>
        <p><strong>Contribution Frequency:</strong> {{ chama.contribution_frequency }}</p>
        <p><strong>Total Contributions:</strong> KSh {{ total_contributions|floatformat:2 }}</p>
        <p><strong>Members:</strong> {{ member_count }}</p>
        <p><strong>Your Role:</strong> {{ membership.get_role_display }}</p>
    </div>
    
    <div class="chama-actions-bar">
        <a href="{% url 'contribution_add' chama.id %}" class="btn btn-primary">Add Contribution</a>
        <a href="{% url 'contribution_list' chama.id %}" class="btn btn-secondary">View Contributions</a>
        {% if membership.role in 'admin,treasurer,chairperson' %}
        <a href="{% url 'transaction_add' chama.id %}" class="btn btn-secondary">Add Transaction</a>
        <a href="{% url 'transaction_list' chama.id %}" class="btn btn-secondary">View Transactions</a>
        {% endif %}
        {% if can_edit %}
        <a href="{% url 'announcement_add' chama.id %}" class="btn btn-secondary">Create Announcement</a>
        {% endif %}
        <a href="{% url 'announcement_list' chama.id %}" class="btn btn-secondary">View Announcements</a>
    </div>
    
    <div class="dashboard-grid">
        <div class="dashboard-section">
            <h3>Recent Contributions</h3>
            {% if recent_contributions %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Member</th>
                        <th>Amount</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for contribution in recent_contributions %}
                    <tr>
                        <td>{{ contribution.membership.user.username }}</td>
                        <td>KSh {{ contribution.amount|floatformat:2 }}</td>
                        <td>{{ contribution.date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No contributions yet.</p>
            {% endif %}
        </div>
        
        <div class="dashboard-section">
            <h3>Recent Transactions</h3>
            {% if recent_transactions %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Purpose</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in recent_transactions %}
                    <tr>
                        <td>{{ transaction.get_transaction_type_display }}</td>
                        <td>KSh {{ transaction.amount|floatformat:2 }}</td>
                        <td>{{ transaction.purpose }}</td>
                        <td>{{ transaction.date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No transactions yet.</p>
            {% endif %}
        </div>
        
        <div class="dashboard-section">
            <h3>Announcements</h3>
            {% if announcements %}
            <div class="announcement-list">
                {% for announcement in announcements %}
                <div class="announcement-item {% if announcement.is_important %}important{% endif %}">
                    <h4>{{ announcement.title }}</h4>
                    <p>{{ announcement.content|truncatewords:30 }}</p>
                    <small>By {{ announcement.created_by.username }} on {{ announcement.created_at|date:"M d, Y" }}</small>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>No announcements yet.</p>
            {% endif %}
        </div>
        
        <div class="dashboard-section">
            <h3>Members</h3>
            {% if members %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Joined</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td>{{ member.user.username }}</td>
                        <td>{{ member.get_role_display }}</td>
                        <td>{{ member.joined_at|date:"M d, Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No members yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

